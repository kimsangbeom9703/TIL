# ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ëŠ” ë²•

## ìŠˆí¼ê´€ë¦¬ì ë“±ë¡
---
### package.json ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
```json
"scripts": {
    "typeorm": "typeorm-ts-node-commonjs",
    "migration:run": "typeorm-ts-node-commonjs migration:run -d ./src/config/data-source.ts",
    "migration:revert": "typeorm-ts-node-commonjs migration:revert -d ./src/config/data-source.ts"
}
```
```bash
npm run typeorm -- migration:create src/migrations/SeedSuperAdmin
```

## ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆ˜ì •
```ts
import { MigrationInterface, QueryRunner } from "typeorm";
import crypto from "crypto";

export class SeedSuperAdmin1756950882105 implements MigrationInterface {
    public async up(queryRunner: QueryRunner): Promise<void> {
        const username = 'admin';
        const passwordPlain = '1234'; // ğŸš¨ ìš´ì˜ì—ì„œëŠ” ê°•ë ¥í•˜ê²Œ ë³€ê²½
        const salt = crypto.randomBytes(16).toString('hex');
        const hash = crypto.createHmac('sha256', salt).update(passwordPlain).digest('hex');

        const exists = await queryRunner.query(
            `SELECT * FROM users WHERE username = ? LIMIT 1`,
            [username],
        );

        if (exists.length === 0) {
            await queryRunner.query(
                `INSERT INTO users (username, password, passwordSalt, role, isActive, createdAt, updatedAt)
         VALUES (?, ?, ?, ?, ?, NOW(), NOW())`,
                [username, hash, salt, 'SUPER_ADMIN', true],
            );
            console.log('âœ… SUPER_ADMIN ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
            console.log('âš ï¸ SUPER_ADMIN ê³„ì •ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.');
        }
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(
            `DELETE FROM users WHERE username = ?`,
            ['superadmin'],
        );
    }
}
```

## ì‹¤í–‰
```
npm run migration:run
```