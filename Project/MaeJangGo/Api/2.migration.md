# 마이그레이션 하는 법

## 슈퍼관리자 등록
---
### package.json 스크립트 추가
```json
"scripts": {
    "typeorm": "typeorm-ts-node-commonjs",
    "migration:run": "typeorm-ts-node-commonjs migration:run -d ./src/config/data-source.ts",
    "migration:revert": "typeorm-ts-node-commonjs migration:revert -d ./src/config/data-source.ts"
}
```
```bash
npm run typeorm -- migration:create src/migrations/SeedSuperAdmin
```

## 마이그레이션 수정
```ts
import { MigrationInterface, QueryRunner } from "typeorm";
import crypto from "crypto";

export class SeedSuperAdmin1756950882105 implements MigrationInterface {
    public async up(queryRunner: QueryRunner): Promise<void> {
        const username = 'admin';
        const passwordPlain = '1234'; // 🚨 운영에서는 강력하게 변경
        const salt = crypto.randomBytes(16).toString('hex');
        const hash = crypto.createHmac('sha256', salt).update(passwordPlain).digest('hex');

        const exists = await queryRunner.query(
            `SELECT * FROM users WHERE username = ? LIMIT 1`,
            [username],
        );

        if (exists.length === 0) {
            await queryRunner.query(
                `INSERT INTO users (username, password, passwordSalt, role, isActive, createdAt, updatedAt)
         VALUES (?, ?, ?, ?, ?, NOW(), NOW())`,
                [username, hash, salt, 'SUPER_ADMIN', true],
            );
            console.log('✅ SUPER_ADMIN 계정이 생성되었습니다.');
        } else {
            console.log('⚠️ SUPER_ADMIN 계정이 이미 존재합니다.');
        }
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(
            `DELETE FROM users WHERE username = ?`,
            ['superadmin'],
        );
    }
}
```

## 실행
```
npm run migration:run
```