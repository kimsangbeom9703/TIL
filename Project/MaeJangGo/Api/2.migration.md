# 마이그레이션 하는 법

## 슈퍼관리자 등록
---
### package.json 스크립트 추가
```json
"scripts": {
    "typeorm": "typeorm-ts-node-commonjs",
    "migration:run": "typeorm-ts-node-commonjs migration:run -d ./src/config/data-source.ts",
    "migration:revert": "typeorm-ts-node-commonjs migration:revert -d ./src/config/data-source.ts"
}
```
```bash
npm run typeorm -- migration:create src/migrations/SeedSuperAdmin
```

## 마이그레이션 수정
```ts
import {MigrationInterface, QueryRunner} from "typeorm";
import * as argon2 from "argon2";

export class SeedSuperAdminArgon21756968000004 implements MigrationInterface {

    public async up(queryRunner: QueryRunner): Promise<void> {
        const username = 'admin';
        const passwordPlain = '1234'; // 🚨 운영에서는 강력하게 변경
        const hash = await argon2.hash(passwordPlain, {
            type: argon2.argon2id,
            memoryCost: 2 ** 16,
            timeCost: 5,
            parallelism: 1,
        });

        await queryRunner.query(
            `INSERT INTO users (username, password, role, isActive, loginFailCount) 
   VALUES (?, ?, ?, ?, ?)`,
            [username, hash, 'SUPER_ADMIN', true, 0]
        );
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        const username = 'admin';
        await queryRunner.query(
            `DELETE FROM users WHERE username = ?`,
            [username]
        );
    }

}

```

## 실행
```
npm run migration:run
```